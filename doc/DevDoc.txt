********************************************************************************
DevDoc.txt: Development notes
Author: Fabrizio Branca, Michael Knoll, Rainer Kuhn et. al.

Legend:

FIX: fixes a bug
CHG: inform about changed items
ADD: added feature
RMV: removed Item
RFT: refactoring / code cleanup
********************************************************************************


ToDo: As of 06.10.2009
======================

- [TODO] check and extend changes for default XSS prevention
  - check already implemented adaptions of rk in tx_ptlist_controller_list (see changelog below) - is this the right place?
  + IMPORTANT: make default XSS prevention configurable for a complete list (e.g. pt_list usage for CSV and PDF)
  - Alternative, but not-so-easy-to-implement: make default XSS prevention configurable for each dataDescriptionIdentifier via Typoscript) 
  - IMPORTANT: check for further default prevention actions
  - check new default XSS prevention behaviour of pt_mvc for unwanted effects, for 
    + breadcrumbs, 
    - bookmarks 
    - and other list features using tx_ptmvc_view::addItem()
- [TODO] FB: Crawlable/Cacheable
  - retrieve appendString from all components (pager, list) and not only from filterCollection
  - append appendString to all url (incl. sorting links in the list)
  - check / modify current filters and include the appendString to all urls that are generated
- (fb&mk) Refactor tx_ptlist_controller_list::init()
- (mk) Change TS for filters that use jQuery
- (mk) XML Export
- (mk) Change the way of how CSS for datepicker filter is included
- (mk) Change the way of how JS for datepicker filter is included
       At the moment, datepicker TS includes JS files "directly" from pt_jqueryui-extension.
       Think of mechanism to do this via JS manager (see pt_jqueryui DevDoc) 
- (mk) DatePicker and Timespan2 Filter don't work together because of dates from datepicker Filter
       influence Timespan's datepicker. Think of a better solution (--> jm)



TODO for version 0.0.3-dev
==========================

- (mk) Introduce autoload-mechanism
  - perhaps this is no longer necessary in EXTBase so could be done later
- (mk) Introduce filterValue objects to encapsulate all filter value operations
- (mk) Refactor filter classes to use filter model object instead of "monster" controller
- (mk) Introduce query builder to abstract generation of SQL Clauses
- (mk) Refactor tx_ptlist_controller_list::init()
- (mk) Introduce factory to build listObjects


Version 0.0.3-dev
=================




Version 0.0.2-dev
=================

+ (mk) ADD: Added parameter for date picker getEventDates() hook
+ (mk) FIX: Fixed javascript Bug in datepicker filter
+ (mk) CHG: Removed HTML encoding from list columns. Column labels are no longer encoded as there is no chance of XSS on column descriptions. Now it's possible to use Images etc. in the column descriptions.
+ (rk) RFT: manual: fixed "->columnDescriptionDefinition"documentation: removed ->stdWrap from "columnIdentifier", added ->stdWrap to "label"
+ (rk) RFT: manual: re-added missing "onValidated" documentation that has been overwritten by someone
+ (fb) RFT: improved a performance by caching extension paths (in some places)
+ (mk) CHG: Removed die() if no jquery extension is installed and changed it to throw an exception (DatePicker / TimeSpan2)
+ (mk) CHG: Moved template for filters into doc directory
+ (mk) ADD: Added new configuration 'sortingColumnDescriptionOnSubmit' for filters
+ (mk) RFT: Changed TimeSpan2 Filter to use pt_jqueryui files
+ (mk) ADD: Registered static template for DatePicker Filter in ext_localconf.php
+ (mk) FIX: Fixed bug in DatePicker Filter (no tablename in where clause caused ambiguous SQL statements)
+ (mk) RFT: Changed inclusion of CSS for datepicker to use CSS file from pt_jqueryui extension
+ (mk) RFT: Changed datepicker filter to use pt_jqueryui for jQuery inclusion
+ (mk) ADD: Added assertion that pt_jqueryui is loaded when datepicker filter is used
+ (mk) ADD: Added template for developing filters: /controller/filter/developmentTemplate/class.FILTER_TEMPLATE.php
+ (mk) ADD: Added some documentation on new filters
+ (mk) ADD: Added some aliases for new filters in plugin.tx_ptlist.alias.ts
+ (mk) RFT: Refactored range filter
+ (mk) RFT: Refactored datePicker filter
+ (mk) RFT: Refactored firstLetter filter
+ (mk) RFT: Added some documentation on timespan filter
+ (mk) DEL: Removed jquery stuff from ressources
+ (mk) RFT: Added comments on all filter classes
+ (mk) RFT: Did some refactoring on 'tx_ptlist_controller_filter_options_base'
+ (mk) RFT: Adapted maximum filter
+ (mk) RFT: Adapted minium filter 
+ (mk) RFT: Changed myDemoList TS to show submit labels for filters
+ (mk) RFT: Adapted string filter template for new naming convention
+ (mk) RFT: Changed name of filter config in template. Variable is now called 'filterconf' instead of 'filter' which made no sense
+ (mk) RFT: Changed 'string' filter to new behaviour of filter controller class
+ (mk) RFT: Added template method 'preSubmit()' to filter controller to run functionality that sould be done BEFORE filter is submited (e.g. set values from forms etc.)
+ (mk) RFT: Added new generic filter userInterface class 'class.tx_ptlist_view_filter_userInterface.php' for filter user interfaces
+ (mk) RFT: Changed filter main controller class to avoid code duplication



Version 0.0.1
=============

+ (fb) FIX: ADD: preset array values for filters support stdWrap now (sorry for forgetting to commit tx_pttools_div::stdWrapArray :)
       + added documentation to the manual
+ (rk) FIX: commented non-compatible tx_pttools_div::stdWrapArray line (currently not available in SVN)
+ (rk) FIX: removed Smarty debug command from filter_timeSpan2_userInterface.tpl
+ (fb) ADD: added filter configuration option: "dropActionParameter" and list controller configuration option "appendFilterValuesToUrls"
       + This is needed to make lists crawlable and cacheable 
       + Updated the manual. See there for detailed information under
         + "Plugin Configuration" -> "plugin.tx_ptlist.controller.list" -> "appendFilterValuesToUrls"
         + and "List Configuration ï¿½ Details" -> "->filterDefinition" -> "dropActionParameter"
         + and "How to make you list crawlable and cacheable"
+ (fb) ADD: some phpdoc code comment
+ (fb) ADD: preset array values for filters support stdWrap now 
+ (rk) ADD: tx_ptlist_div::getTypoLink_URL(): added possibility to add URL parameters for redirect target page
+ (fb) ADD: tx_ptlist_renderer->translate()
+ (jm) CHG: Switched from date() function to strftime() function in Date Pager filter, to get 'locale' functionality. 
+ (jm) FIX: Fixed tag id in Date Picker template. Caused conflicts with Tidy extension.
+ (jm) ADD: Added new Date Pager filter functionality
+ (jm) ADD: Added new Date Pager filter
+ (jm) ADD: Added new TS options for date picker filter
+ (jm) ADD: Added fullQuoteStr() to getSqlWhereClauseSnippet fields in date picker
+ (jm) FIX: Replaced date specifiers for day and month in SQL query of date picker filter
+ (mk) CHG: Added empty row before structure header in structured list
+ (rk) ADD/RFT: added TS stdWrap toolbox to "noElementsFoundText" configuration, refactored "noElementsFoundText" implementation
+ (rk) RFT: tx_ptlist_filter: renamed setDefaultValueFromTs() to setPresetStateFromTs(), resetToTsConfigAction() to resetToTsPresetStateAction() and setIsActiveAndDefaultValueFromArray() to setPresetStateFromArray()
+ (mk) RFT: Added proxy method for setting default value and isActive in tx_ptlist_filter
+ (mk) ADD: Added tx_ptlist_filter::resetToTsConfigAction for resetting a filter to the TS default configuration
+ (mk) FIX: Structured lists do not show sorting headers anymore. Structured lists have correct odd/even classes for headers now (always starts with odd on header)
+ (mk) ADD: Added some documentation on structured lists
+ (mk) ADD: Added some documentation on configuration settings in pt_list
+ (rk) ADD: added inline comments to tx_ptlist_controller_list::getConfiguration()
+ (rk/dl) ADD: added  "->stdWrap" hint for several fields, added documentation for dataDescriptionDefinition "field" property
+ (mk) FIX: Fixed bug in resetSortingState, default sorting is now reset if configured
+ (rk) ADD: tx_ptlist_controller_filter_datePicker: added SQL where clause hooks in getEventDates() and getSqlWhereClauseSnippet() 
+ (rk) CHG: extended devlog entry text for tx_ptlist_div::hookEofe()
+ (mk) FIX: Fixed some problems with structured lists
+ (rk) CHG: tx_ptlist_controller_filter_string: adapted filter submission handling to "newer" methods of the parent class tx_ptlist_filter
+ (rk) ADD: Added new general filter config "resetFilters" to reset other filters when validating the current one
+ (jm) FIX: Reset image path for datePicker calendar icon  
+ (jm) ADD: Added new datePicker filter
+ (fb) FIX: Bug while resetting options filter in toggle mode
+ (fb) ADD: added configuration option dontProcessTwice to avoid filters to be processed twice. See comment in tx_ptlist_list::update() for details about this problem
+ (fb) RFT: moved $conf from class.tx_ptlist_typo3Tables_list.php to abstract class tx_ptlist_list
+ (fb) BUG: fixed bug in filter_options_userInterface_links.tpl: urlencode was applied to the whole additionalParams string instead of the value only
+ (mk) ADD: Added new filter timeSpan2 to select two dates
+ (fb) BUG: added sortingDataDescriptions to the selectClause.
+ (fb) BUG: in list_itemList.tpl there was a "$columnDescriptionIdentifier|in_array:$structure_by_cols" construct which fails if
       $structure_by_cols is not an array. I didn't looked deeper into why this is no array, but simply added a check before that.
+ (mk) ADD: Possibility to structure a list by certain columns
+ (fb) ADD: apply stdWrap to dataDescription configuration's properties
+ (fb) ADD: string filter now supports "AND" queries: All search words will be concatenated with "and". The resulting expression
       must be in at least one of the data descriptions. To simulate a fulltext search you can create a special datadescription only used 
       by the string search by concatenating all fields you want to search in:
          Example: 
          plugin.tx_ptlist.listConfig.profileSearchResults.data.mySearchField {
                special = CONCAT(fe_users.tx_myext_firstname, '|', fe_users.tx_myext_lastname)
          }
          [...]
          plugin.tx_ptlist.listConfig.profileSearchResults.filters.defaultFilterbox.10 < plugin.tx_ptlist.alias.filter_string
          plugin.tx_ptlist.listConfig.profileSearchResults.filters.defaultFilterbox.10 {
            dataDescriptionIdentifier = mySearchField
            filterIdentifier = search
          }  
+ (mk) ADD: PDF and CSV list now does NOT filter HTML by default. This setting is overwritten by TS plugin.tx_ptlist.view.filterHtml
+ (mk) ADD: Added generic pagers and some documentation on how to use them
+ (mk) FIX: XSS prevention is now configurable via: plugin.tx_ptlist.view.filterHtml
+ (uk) FIX: fixed bug PDF template label variable add |ll:0 to allow label set in language files
+ (fb) FIX: fixed bug with breadcrumb output of range filter
+ (fb) ADD: added some new icons
+ (fb) ADD: added some typoscript examples (not finished yet)
+ (fb) RFT: changed mail address
+ (fb) RFT: minor code improvements
+ (fb) ADD: demo typoscript
+ (fb) ADD: added hint in the manual concerning the bug if external databases use the same credential as the typo3 database
+ (fb) RFT: filter breadcrumb, added html filtering
  + added new method tx_ptlist_filterCollection->where_isActive()
  + filterbreadcrumb can be hidden now via css if no filter is active
  + changed my mail address
+ (rk) CHG: Addition of default XSS prevention for database data, adaption for new default XSS prevention of pt_mvc views 
  ***** IMPORTANT: unfinished - this may result in unwanted effects for existing pt_list implementations! *****
  + tx_ptlist_controller_list:
    + filterboxDefaultAction(): added third param "false" to addItem() of complete filterbox (do not filter HTML here since the complete filterbox is already rendered as HTML)
    + listDefaultAction(): added third param "false" to addItem() of $this->getColumnContents() (do not filter HTML here since the column contents may already be rendered as HTML (e.g. from Typoscript wraps) and the database data is already HTML filtered (see getColumnContents()))
    + getColumnContents(): sending all data description raw data through XSS filter now:
      $values[$dataDescriptionIdentifier] = tx_pttools_div::htmlOutput($itemObj[$dataDescriptionIdentifier]); 
  + ext_emconf.php: raised pt_tools dependency to version "0.4.2-", raised pt_mvc dependency to version "0.0.2-"
+ (mk) ADD: Documentation of how controllers in pt_list are processed and how filters are processed
+ (mk) ADD: tx_ptlist_filter: added possibilty to reset sorting of list by filter if configured in TS
   + (mk) ADD: Configuration key filters.<filter_name>.resetListSortingStateOnSubmit in TS
+ (rk) FIX: tx_ptlist_view_list_itemList_csv::sendHeader(): fixed assertion position, changed default download type to 'I'
+ (mk) ADD: (class.tx_ptlist_list.php) Added method "resetSortingParameters()" for resetting all sorting states of sortable columns
+ (mk) CHG: Items of pdf-view are now converted to utf-8 before XML generation
+ (mk) ADD: Manual for PDF rendering
+ (mk) ADD: PDF rendering is now almost generic
  + (mk) ADD: Added pdf-column width to column description
  + (mk) CHG: Calculate column widths and column positions array by pt_list
  + (mk) CHG: Col pos and col width is scaled by view
+ (mk) ADD: PDF rendering configuration can now be done via TS
+ (mk) ADD: Generic smarty template for PDF rendering (for pt_xml2pdf)
+ (mk) ADD: Sample TS file for pdf rendering (typoscript/static/pdf/plugin.tx_ptlist_pdf_rendering_example.ts) (not tested yet)
+ (mk) ADD: Added TS configuration for CSV filename and type of file handling for generated CSV files
+ (mk) ADD: Added some documentation for generating PDF files with pt_list
+ (mk) ADD: Added TS configuration for PDF filename and type of file handling for generated PDF files 
+ (fb) RMV: tx_ptlist_controller_stringGeneric is obsolete as it can be done with the tx_ptlist_controller_string filter using "dataDescriptionIdentifier = *"
+ (fb) CHG: filterBox configuration has changed. Class is no longer a property, but the value of the main key
    Before:
    10 {
        class < plugin.tx_ptlist.alias.filter_stringGeneric
        filterIdentifier = genericSearch
        label = Suche
        dataDescriptionIdentifier = 
    }
    
    Now: 
    10 < plugin.tx_ptlist.alias.filter_stringGeneric
    10 {
        filterIdentifier = genericSearch
        label = Suche
        dataDescriptionIdentifier = 
    }
+ (fb) ADD: dsn in listConfig and in renderUserFunction "fetchExternalData" can be a dsn string or a uid pointing to the tx_ptlist_databases table 
+ (fb) ADD: New table "tx_ptlist_databases"
+ (fb) CHG: renderUserFunctions only accepts numeric keys
+ (fb) CHG: tx_ptlist_renderer::cObj() renamed to tx_ptlist_renderer::cObject()
  + (fb) CHG: parameter for tx_ptlist_renderer::cObject() renamed from "cObj(.)" to "renderObj(.)"   

  
Configuration

== Extension configuration ==
plugin.tx_<condensedExtKey>.

== Controller configuration ==
plugin.tx_<condensedExtKey>.controller.<controllerName>.

== PrefixId-specific controller configuration ==
plugin.tx_<condensedExtKey>.controller.<controllerName>.<prefixId>.

== ListPrefix specific controller configuration ==
plugin.tx_<condensedExtKey>.controller.<controllerName>.<listPrefix>.

$this->conf = 
    [already existing property $this->conf]
    
        // tx_ptmvc_controllerFrontend->getConfiguration()
    [plugin.tx_<condensedExtKey>.controller.<controllerName>.] +
    [plugin.tx_<condensedExtKey>.controller.<controllerName>.<prefixId>.] +
    [flexFormSettings] +
    
        // tx_ptlist_controller_list->getConfiguration()
    [localConfiguration set in ->main() or ->__construct()] + 
    [plugin.tx_<condensedExtKey>.controller.<controllerName>.<listPrefix>.] +
    
        // tx_mvc_controller->prepare() 
    [localConfiguration set in ->main() or ->__construct()] 
    
    
Views 

plugin.tx_<condensedExtKey>.view.<viewName>.

$this->conf = 
    [plugin.tx_<condensedExtKey>.view.<viewName>.] +
    [<controllerConfig>.view.<viewName>.] 
